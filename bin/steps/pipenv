PIPENV_VERSION=4.0.1

puts-step "Installing pipenv ($PIPENV_VERSION)"
pip install pipenv --exists-action=w --no-index --find-links=$BUILDPACK_PATH/vendor &> /dev/null

pushd $DEPS_DIR/$DEPS_IDX/bin >/dev/null
  ln -sf ../python/bin/* .
popd >/dev/null

if [[ -f $BUILD_DIR/Pipfile ]] && [[ ! -f $BUILD_DIR/requirements.txt ]]; then
    puts-step "Generating requirements.txt from Pipfile"

    if test -d $BUILD_DIR/vendor; then
        (
            export HTTP_PROXY=http://localhost:1234/
            export HTTPS_PROXY=https://localhost:1234/
            export PIP_FIND_LINKS="file://$BUILD_DIR/vendor"
            export PIP_NO_INDEX="true"
            pipenv lock --requirements > $BUILD_DIR/requirements.txt 2> /dev/null
        )
    else
        pipenv lock --requirements > $BUILD_DIR/requirements.txt 2> /dev/null
    fi
fi
